<?xml version="1.0" encoding="UTF-8"?>
<process xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../petriflow_schema.xsd">
    <id>export_filters</id>
    <version>1.0.0</version>
    <title id="export_filters">Export of filters</title>
    <icon>file_download</icon>
    <defaultRole>true</defaultRole>
    <caseName id="export_filters">Export of filters</caseName>
    <!-- CASE EVENTS -->
    <!-- TRANSACTIONS -->
    <!-- ROLES -->
    <!-- PROCESS ROLE REFS -->
    <!-- PROCESS USER REFS -->
    <!-- DATA -->
    <data type="multichoice_map">
        <id>exportable_filters</id>
        <title id="exportable_filters">Exportable filters</title>
        <placeholder id="exportable_filters_placeholder">List of all exportable filters</placeholder>
        <desc id="exportable_filters_desc">Select one or more filters to export</desc>
        <event type="get">
            <id>exportable_filters_get</id>
            <actions phase="pre">
                <action>
                    exportable_filters: f.exportable_filters;

                    change exportable_filters options {
                        return findAllFilters()
                            .collectEntries({filterCase -&gt; [filterCase.stringId, filterCase.title]})
                    }
                </action>
            </actions>
        </event>
    </data>
    <data type="button">
        <id>export_btn</id>
        <placeholder id="export_btn_placeholder">Export filters</placeholder>
        <desc id="export_btn_desc">Export selected filters into xml file</desc>
        <event type="set">
            <id>export_btn_set</id>
            <actions phase="post">
                <action>
                    exportable_filters: f.exportable_filters,
                    export_file: f.export_file,
                    trans: t.exportFilter;

                    change export_file value { exportFilters(exportable_filters.value) }
                    change exportable_filters value { [] }
                    make export_file, visible on trans when {exportable_filters.value.length != 0}
                    make export_file, hidden on trans when {exportable_filters.value.length == 0}
                </action>
            </actions>
        </event>
        <component>
            <id>raised</id>
        </component>
    </data>
    <data type="file">
        <id>export_file</id>
        <title id="export_file">Exported filters</title>
        <placeholder id="export_file_placeholder">File with exported filters</placeholder>
        <desc id="export_file_desc">Download file with exported filters in xml format</desc>
    </data>
    <!-- I18NS -->
    <i18n locale="sk">
        <i18nString id="export_filters">Export filtrov</i18nString>
        <i18nString id="exportable_filters">Exportovateľné filtre</i18nString>
        <i18nString id="exportable_filters_placeholder">Zoznam všetkých exportovateľných filtrov</i18nString>
        <i18nString id="exportable_filters_desc">Vyberte jeden alebo viac filtrov na export</i18nString>
        <i18nString id="export_btn_placeholder">Exportovať filtre</i18nString>
        <i18nString id="export_btn_desc">Export vybraných filtrov do súboru xml</i18nString>
        <i18nString id="export_file">Exportované filtre</i18nString>
        <i18nString id="export_file_placeholder">Súbor s exportovanými filtrami</i18nString>
        <i18nString id="export_file_desc">Stiahnutie súboru s exportovanými filtrami vo formáte xml</i18nString>
    </i18n>
    <i18n locale="de">
        <i18nString id="export_filters">Exportieren von Filtern</i18nString>
        <i18nString id="exportable_filters">Exportierbare Filter</i18nString>
        <i18nString id="exportable_filters_placeholder">Liste aller exportierbaren Filter</i18nString>
        <i18nString id="exportable_filters_desc">Wählen Sie einen oder mehrere Filter für den Export</i18nString>
        <i18nString id="export_btn_placeholder">Filter exportieren</i18nString>
        <i18nString id="export_btn_desc">Ausgewählte Filter in xml-Datei exportieren</i18nString>
        <i18nString id="export_file">Exportierte Filter</i18nString>
        <i18nString id="export_file_placeholder">Datei mit exportierten Filtern</i18nString>
        <i18nString id="export_file_desc">Datei mit exportierten Filtern im xml-Format herunterladen</i18nString>
    </i18n>
    <!-- TRANSITIONS -->
    <transition>
        <id>exportFilter</id>
        <x>200</x>
        <y>100</y>
        <title id="export_btn_placeholder">Export filters</title>
        <assignPolicy>auto</assignPolicy>
        <grid>
            <id>exportFilter_grid</id>
            <item>
                <dataRef>
                    <id>exportable_filters</id>
                    <logic>
                        <behavior>editable</behavior>
                    </logic>
                </dataRef>
                <properties>
                    <grid-column>1 / 2</grid-column>
                </properties>
            </item>
            <item>
                <dataRef>
                    <id>export_btn</id>
                    <logic>
                        <behavior>editable</behavior>
                    </logic>
                </dataRef>
                <properties>
                    <grid-column>2 / 3</grid-column>
                </properties>
            </item>
            <item>
                <dataRef>
                    <id>export_file</id>
                    <logic>
                        <behavior>hidden</behavior>
                    </logic>
                </dataRef>
                <properties>
                    <grid-column>1 / 2</grid-column>
                </properties>
            </item>
            <properties>
                <display>grid</display>
                <grid-template-columns>repeat(2, 1fr)</grid-template-columns>
                <justify-items>stretch</justify-items>
                <align-items>stretch</align-items>
                <justify-content>stretch</justify-content>
                <align-content>stretch</align-content>
            </properties>
        </grid>
        <event type="assign">
            <id>exportFilter_assign</id>
            <actions phase="post">
                <action>
                    make export_file, hidden on exportFilter when {true}
                </action>
            </actions>
        </event>
    </transition>
    <!-- PLACES -->
    <place>
        <id>p1</id>
        <x>100</x>
        <y>100</y>
        <tokens>1</tokens>
    </place>
    <!-- ARCS -->
    <arc>
        <id>a1</id>
        <type>regular</type>
        <sourceId>p1</sourceId>
        <destinationId>exportFilter</destinationId>
        <multiplicity>1</multiplicity>
    </arc>
    <arc>
        <id>a2</id>
        <type>regular</type>
        <sourceId>exportFilter</sourceId>
        <destinationId>p1</destinationId>
        <multiplicity>1</multiplicity>
    </arc>
</process>
